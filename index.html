<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Life Creator - Design and Simulate</title>
    <style>
      :root {
        --primary: #4a6fa5;
        --secondary: #6b8cbc;
        --accent: #ff6b6b;
        --light: #f8f9fa;
        --dark: #343a40;
        --success: #51cf66;
        --warning: #f9c74f;
        --ecosystem-bg: #1a3c27;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
        color: var(--light);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      header {
        text-align: center;
        padding: 20px 0;
        margin-bottom: 30px;
      }

      h1 {
        font-size: 3rem;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      }

      .subtitle {
        font-size: 1.2rem;
        opacity: 0.9;
      }

      .tabs {
        display: flex;
        justify-content: center;
        margin-bottom: 20px;
        gap: 10px;
      }

      .tab {
        padding: 12px 24px;
        background: rgba(255, 255, 255, 0.1);
        border: none;
        border-radius: 8px;
        color: white;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s;
      }

      .tab.active {
        background: var(--primary);
        transform: translateY(-2px);
      }

      .tab:hover:not(.active) {
        background: rgba(255, 255, 255, 0.2);
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .main-content {
        display: flex;
        flex-wrap: wrap;
        gap: 30px;
        margin-bottom: 40px;
      }

      .creation-panel {
        flex: 1;
        min-width: 300px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      }

      .preview-panel {
        flex: 1;
        min-width: 300px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }

      .ecosystem {
        width: 100%;
        height: 500px;
        background: var(--ecosystem-bg);
        border-radius: 15px;
        position: relative;
        overflow: hidden;
        margin-bottom: 20px;
        border: 3px solid rgba(255, 255, 255, 0.2);
      }

      .simulation-controls {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .simulation-info {
        text-align: center;
        margin-bottom: 20px;
        padding: 15px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
      }

      .panel-title {
        font-size: 1.5rem;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid var(--secondary);
      }

      .form-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
      }

      input,
      select,
      textarea {
        width: 100%;
        padding: 12px;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        background: rgba(255, 255, 255, 0.1);
        color: white;
        font-size: 1rem;
      }

      input::placeholder,
      textarea::placeholder {
        color: rgba(255, 255, 255, 0.7);
      }

      .color-picker {
        display: flex;
        gap: 10px;
        margin-top: 10px;
      }

      .color-option {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        cursor: pointer;
        border: 2px solid transparent;
        transition: transform 0.2s;
      }

      .color-option:hover {
        transform: scale(1.2);
      }

      .color-option.selected {
        border-color: white;
        transform: scale(1.2);
      }

      .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
      }

      .btn-primary {
        background: var(--primary);
        color: white;
      }

      .btn-primary:hover {
        background: var(--secondary);
        transform: translateY(-2px);
      }

      .btn-secondary {
        background: transparent;
        color: white;
        border: 2px solid white;
      }

      .btn-secondary:hover {
        background: rgba(255, 255, 255, 0.1);
      }

      .btn-success {
        background: var(--success);
        color: white;
      }

      .btn-success:hover {
        background: #40ba57;
        transform: translateY(-2px);
      }

      .btn-warning {
        background: var(--warning);
        color: black;
      }

      .btn-warning:hover {
        background: #e6b63c;
        transform: translateY(-2px);
      }

      .btn-info {
        background: #17a2b8;
        color: white;
      }

      .btn-info:hover {
        background: #138496;
        transform: translateY(-2px);
      }

      .life-preview {
        width: 200px;
        height: 200px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 30px;
        position: relative;
        overflow: visible;
      }

      .life-form {
        width: 80%;
        height: 80%;
        border-radius: 50%;
        position: relative;
      }

      .life-features {
        position: absolute;
        width: 100%;
        height: 100%;
      }

      .eye {
        position: absolute;
        width: 20px;
        height: 20px;
        background: white;
        border-radius: 50%;
        top: 30%;
      }

      .eye.left {
        left: 25%;
      }

      .eye.right {
        right: 25%;
      }

      .pupil {
        position: absolute;
        width: 10px;
        height: 10px;
        background: black;
        border-radius: 50%;
        top: 5px;
        left: 5px;
      }

      .mouth {
        position: absolute;
        width: 40%;
        height: 15px;
        background: white;
        border-radius: 0 0 20px 20px;
        bottom: 25%;
        left: 30%;
      }

      .limb {
        position: absolute;
        opacity: 0.8;
      }

      .limb.horizontal {
        width: 60px;
        height: 15px;
        border-radius: 10px;
      }

      .limb.vertical {
        width: 15px;
        height: 60px;
        border-radius: 10px;
      }

      .limb.top {
        top: -10px;
        left: 50%;
        transform: translateX(-50%);
      }

      .limb.bottom {
        bottom: -10px;
        left: 50%;
        transform: translateX(-50%);
      }

      .limb.left {
        left: -10px;
        top: 50%;
        transform: translateY(-50%);
      }

      .limb.right {
        right: -10px;
        top: 50%;
        transform: translateY(-50%);
      }

      .life-name {
        font-size: 1.5rem;
        margin-top: 20px;
        text-align: center;
      }

      .life-description {
        margin-top: 10px;
        text-align: center;
        opacity: 0.9;
      }

      .gallery {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 40px;
      }

      .life-card {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 15px;
        text-align: center;
        transition: transform 0.3s;
        cursor: pointer;
      }

      .life-card:hover {
        transform: translateY(-5px);
      }

      .life-card.selected {
        border: 2px solid var(--success);
      }

      .life-card-preview {
        width: 100px;
        height: 100px;
        margin: 0 auto 10px;
        border-radius: 50%;
        position: relative;
        overflow: visible;
      }

      .simulated-life {
        position: absolute;
        transition: all 0.5s ease;
      }

      .simulated-life .life-features {
        position: absolute;
        width: 100%;
        height: 100%;
      }

      .structure {
        position: absolute;
        border: 2px solid rgba(255, 255, 255, 0.3);
        transition: all 0.3s ease;
      }

      .structure.house {
        background: rgba(139, 69, 19, 0.7);
        border-radius: 10px;
      }

      .structure.rock {
        background: rgba(128, 128, 128, 0.7);
        border-radius: 50%;
      }

      .structure.tree {
        background: rgba(34, 139, 34, 0.7);
        border-radius: 50% 50% 0 0;
      }

      .structure.water {
        background: rgba(0, 105, 148, 0.5);
        border-radius: 10px;
      }

      .structure.crystal {
        background: rgba(157, 78, 221, 0.6);
        border-radius: 10px;
        animation: glow 2s ease-in-out infinite alternate;
      }

      @keyframes glow {
        from {
          box-shadow: 0 0 5px #9d4edd;
        }
        to {
          box-shadow: 0 0 15px #9d4edd;
        }
      }

      .age-indicator {
        position: absolute;
        top: -15px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 10px;
        color: white;
        background: rgba(0, 0, 0, 0.5);
        padding: 2px 5px;
        border-radius: 10px;
        white-space: nowrap;
      }

      .food {
        position: absolute;
        width: 10px;
        height: 10px;
        background: #f9c74f;
        border-radius: 50%;
      }

      .evolution-particle {
        position: absolute;
        width: 5px;
        height: 5px;
        background: #9d4edd;
        border-radius: 50%;
        animation: float 2s ease-in-out infinite;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      .stats {
        display: flex;
        justify-content: space-around;
        margin-top: 20px;
        padding: 15px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        flex-wrap: wrap;
      }

      .stat {
        text-align: center;
        margin: 5px 10px;
      }

      .stat-value {
        font-size: 1.5rem;
        font-weight: bold;
      }

      .generation-counter {
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(0, 0, 0, 0.5);
        padding: 5px 10px;
        border-radius: 10px;
        font-size: 0.9rem;
      }

      .notification {
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 15px 25px;
        background: var(--success);
        color: white;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        transform: translateY(100px);
        opacity: 0;
        transition: all 0.5s;
        z-index: 1000;
        max-width: 300px;
      }

      .notification.warning {
        background: var(--warning);
        color: black;
      }

      .notification.evolution {
        background: #9d4edd;
      }

      .notification.structure {
        background: #17a2b8;
      }

      .notification.show {
        transform: translateY(0);
        opacity: 1;
      }

      .evolution-log {
        max-height: 200px;
        overflow-y: auto;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        padding: 15px;
        margin-top: 20px;
      }

      .evolution-log h4 {
        margin-bottom: 10px;
        color: var(--warning);
      }

      .log-entry {
        padding: 5px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        font-size: 0.9rem;
      }

      .log-entry.evolution {
        color: #9d4edd;
      }

      .log-entry.death {
        color: var(--accent);
      }

      .log-entry.birth {
        color: var(--success);
      }

      .log-entry.structure {
        color: #17a2b8;
      }

      .structure-controls {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-bottom: 15px;
        flex-wrap: wrap;
      }

      @media (max-width: 768px) {
        .main-content {
          flex-direction: column;
        }

        h1 {
          font-size: 2.2rem;
        }

        .ecosystem {
          height: 300px;
        }

        .simulation-controls,
        .structure-controls {
          flex-direction: column;
          align-items: center;
        }

        .stats {
          flex-direction: column;
          gap: 10px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>Life Creator</h1>
        <p class="subtitle">
          Design unique life forms and simulate their evolution
        </p>
      </header>

      <div class="tabs">
        <button class="tab active" data-tab="creation">Creation</button>
        <button class="tab" data-tab="simulation">Simulation</button>
      </div>

      <div class="tab-content active" id="creation-tab">
        <div class="main-content">
          <div class="creation-panel">
            <h2 class="panel-title">Design Your Life Form</h2>

            <div class="form-group">
              <label for="lifeName">Life Form Name</label>
              <input
                type="text"
                id="lifeName"
                placeholder="Enter a creative name"
              />
            </div>

            <div class="form-group">
              <label for="lifeType">Life Type</label>
              <select id="lifeType">
                <option value="organic">Organic</option>
                <option value="mechanical">Mechanical</option>
                <option value="energy">Energy Being</option>
                <option value="hybrid">Hybrid</option>
                <option value="crystal">Crystal Entity</option>
              </select>
            </div>

            <div class="form-group">
              <label>Primary Color</label>
              <div class="color-picker">
                <div
                  class="color-option selected"
                  style="background-color: #4a6fa5"
                  data-color="#4a6fa5"
                ></div>
                <div
                  class="color-option"
                  style="background-color: #51cf66"
                  data-color="#51cf66"
                ></div>
                <div
                  class="color-option"
                  style="background-color: #ff6b6b"
                  data-color="#ff6b6b"
                ></div>
                <div
                  class="color-option"
                  style="background-color: #f9c74f"
                  data-color="#f9c74f"
                ></div>
                <div
                  class="color-option"
                  style="background-color: #9d4edd"
                  data-color="#9d4edd"
                ></div>
              </div>
            </div>

            <div class="form-group">
              <label>Features</label>
              <div>
                <input type="checkbox" id="hasEyes" checked />
                <label for="hasEyes" style="display: inline">Eyes</label>
              </div>
              <div>
                <input type="checkbox" id="hasMouth" checked />
                <label for="hasMouth" style="display: inline">Mouth</label>
              </div>
              <div>
                <input type="checkbox" id="hasLimbs" />
                <label for="hasLimbs" style="display: inline">Limbs</label>
              </div>
            </div>

            <div class="form-group">
              <label for="lifeDescription">Description</label>
              <textarea
                id="lifeDescription"
                rows="3"
                placeholder="Describe your life form's characteristics"
              ></textarea>
            </div>

            <button class="btn btn-primary" id="createLife">
              Create Life Form
            </button>
            <button class="btn btn-secondary" id="resetForm">Reset</button>
          </div>

          <div class="preview-panel">
            <h2 class="panel-title">Life Form Preview</h2>

            <div class="life-preview">
              <div
                class="life-form"
                id="previewLifeForm"
                style="background-color: #4a6fa5"
              >
                <div class="life-features">
                  <div class="eye left">
                    <div class="pupil"></div>
                  </div>
                  <div class="eye right">
                    <div class="pupil"></div>
                  </div>
                  <div class="mouth"></div>
                </div>
              </div>
            </div>

            <div class="life-name" id="previewName">Unnamed Life Form</div>
            <div class="life-description" id="previewDescription">
              No description provided
            </div>
          </div>
        </div>

        <h2 class="panel-title">Your Created Life Forms</h2>
        <div class="gallery" id="lifeGallery">
          <!-- Life forms will be added here dynamically -->
        </div>
      </div>

      <div class="tab-content" id="simulation-tab">
        <div class="simulation-info">
          <h3>Ecosystem Simulation</h3>
          <p>
            Watch your created life forms interact, age, reproduce, and evolve
            in a simulated environment with structures.
          </p>
        </div>

        <div class="simulation-controls">
          <button class="btn btn-success" id="startSimulation">
            Start Simulation
          </button>
          <button class="btn btn-secondary" id="stopSimulation">
            Stop Simulation
          </button>
          <button class="btn btn-primary" id="addFood">Add Food</button>
          <button class="btn btn-warning" id="speedUp">Speed Up 2x</button>
          <button class="btn btn-secondary" id="clearSimulation">
            Clear All
          </button>
        </div>

        <div class="structure-controls">
          <button class="btn btn-info" id="addHouse">Add House</button>
          <button class="btn btn-info" id="addRock">Add Rock</button>
          <button class="btn btn-info" id="addTree">Add Tree</button>
          <button class="btn btn-info" id="addWater">Add Water</button>
          <button class="btn btn-info" id="addCrystal">Add Crystal</button>
        </div>

        <div class="ecosystem" id="ecosystem">
          <!-- Simulated life forms, food, and structures will appear here -->
        </div>

        <div class="stats">
          <div class="stat">
            <div class="stat-value" id="lifeCount">0</div>
            <div>Life Forms</div>
          </div>
          <div class="stat">
            <div class="stat-value" id="foodCount">0</div>
            <div>Food Items</div>
          </div>
          <div class="stat">
            <div class="stat-value" id="structureCount">0</div>
            <div>Structures</div>
          </div>
          <div class="stat">
            <div class="stat-value" id="generationCount">1</div>
            <div>Generation</div>
          </div>
          <div class="stat">
            <div class="stat-value" id="timeElapsed">0s</div>
            <div>Time Elapsed</div>
          </div>
          <div class="stat">
            <div class="stat-value" id="evolutionCount">0</div>
            <div>Evolutions</div>
          </div>
        </div>

        <div class="evolution-log">
          <h4>Simulation Log</h4>
          <div id="logEntries">
            <!-- Log entries will appear here -->
          </div>
        </div>

        <h2 class="panel-title">Available Life Forms</h2>
        <div class="gallery" id="simulationGallery">
          <!-- Life forms available for simulation will be added here -->
        </div>
      </div>

      <div class="notification" id="notification">
        Life form created successfully!
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // DOM Elements
        const lifeNameInput = document.getElementById("lifeName");
        const lifeTypeSelect = document.getElementById("lifeType");
        const colorOptions = document.querySelectorAll(".color-option");
        const hasEyesCheckbox = document.getElementById("hasEyes");
        const hasMouthCheckbox = document.getElementById("hasMouth");
        const hasLimbsCheckbox = document.getElementById("hasLimbs");
        const lifeDescriptionInput = document.getElementById("lifeDescription");
        const createLifeButton = document.getElementById("createLife");
        const resetButton = document.getElementById("resetForm");
        const previewLifeForm = document.getElementById("previewLifeForm");
        const previewName = document.getElementById("previewName");
        const previewDescription =
          document.getElementById("previewDescription");
        const lifeGallery = document.getElementById("lifeGallery");
        const simulationGallery = document.getElementById("simulationGallery");
        const notification = document.getElementById("notification");

        // Simulation elements
        const ecosystem = document.getElementById("ecosystem");
        const startSimulationBtn = document.getElementById("startSimulation");
        const stopSimulationBtn = document.getElementById("stopSimulation");
        const addFoodBtn = document.getElementById("addFood");
        const speedUpBtn = document.getElementById("speedUp");
        const clearSimulationBtn = document.getElementById("clearSimulation");
        const lifeCountEl = document.getElementById("lifeCount");
        const foodCountEl = document.getElementById("foodCount");
        const structureCountEl = document.getElementById("structureCount");
        const generationCountEl = document.getElementById("generationCount");
        const timeElapsedEl = document.getElementById("timeElapsed");
        const evolutionCountEl = document.getElementById("evolutionCount");
        const logEntriesEl = document.getElementById("logEntries");

        // Structure buttons
        const addHouseBtn = document.getElementById("addHouse");
        const addRockBtn = document.getElementById("addRock");
        const addTreeBtn = document.getElementById("addTree");
        const addWaterBtn = document.getElementById("addWater");
        const addCrystalBtn = document.getElementById("addCrystal");

        // Tab functionality
        const tabs = document.querySelectorAll(".tab");
        const tabContents = document.querySelectorAll(".tab-content");

        tabs.forEach((tab) => {
          tab.addEventListener("click", () => {
            const tabId = tab.getAttribute("data-tab");

            // Update tabs
            tabs.forEach((t) => t.classList.remove("active"));
            tab.classList.add("active");

            // Update tab contents
            tabContents.forEach((content) =>
              content.classList.remove("active")
            );
            document.getElementById(`${tabId}-tab`).classList.add("active");

            // Refresh simulation gallery when switching to simulation tab
            if (tabId === "simulation") {
              refreshSimulationGallery();
            }
          });
        });

        // State variables
        let selectedColor = "#4a6fa5";
        let createdLifeForms = [];
        let simulatedLifeForms = [];
        let foodItems = [];
        let structures = [];
        let simulationInterval = null;
        let simulationTime = 0;
        let selectedLifeFormId = null;
        let simulationSpeed = 1;
        let generation = 1;
        let evolutionCount = 0;
        let logEntries = [];

        // Color selection
        colorOptions.forEach((option) => {
          option.addEventListener("click", function () {
            colorOptions.forEach((opt) => opt.classList.remove("selected"));
            this.classList.add("selected");
            selectedColor = this.getAttribute("data-color");
            updatePreview();
          });
        });

        // Update preview when inputs change
        lifeNameInput.addEventListener("input", updatePreview);
        lifeTypeSelect.addEventListener("change", updatePreview);
        hasEyesCheckbox.addEventListener("change", updatePreview);
        hasMouthCheckbox.addEventListener("change", updatePreview);
        hasLimbsCheckbox.addEventListener("change", updatePreview);
        lifeDescriptionInput.addEventListener("input", updatePreview);

        // Create life form
        createLifeButton.addEventListener("click", function () {
          const lifeForm = {
            id: Date.now(),
            name: lifeNameInput.value || "Unnamed Life Form",
            type: lifeTypeSelect.value,
            color: selectedColor,
            hasEyes: hasEyesCheckbox.checked,
            hasMouth: hasMouthCheckbox.checked,
            hasLimbs: hasLimbsCheckbox.checked,
            description:
              lifeDescriptionInput.value || "No description provided",
            generation: 1,
          };

          createdLifeForms.push(lifeForm);
          addLifeToGallery(lifeForm);
          showNotification("Life form created successfully!");
        });

        // Reset form
        resetButton.addEventListener("click", function () {
          lifeNameInput.value = "";
          lifeTypeSelect.value = "organic";
          colorOptions[0].click();
          hasEyesCheckbox.checked = true;
          hasMouthCheckbox.checked = true;
          hasLimbsCheckbox.checked = false;
          lifeDescriptionInput.value = "";
          updatePreview();
        });

        // Simulation controls
        startSimulationBtn.addEventListener("click", startSimulation);
        stopSimulationBtn.addEventListener("click", stopSimulation);
        addFoodBtn.addEventListener("click", addFood);
        speedUpBtn.addEventListener("click", speedUpSimulation);
        clearSimulationBtn.addEventListener("click", clearSimulation);

        // Structure controls
        addHouseBtn.addEventListener("click", () => addStructure("house"));
        addRockBtn.addEventListener("click", () => addStructure("rock"));
        addTreeBtn.addEventListener("click", () => addStructure("tree"));
        addWaterBtn.addEventListener("click", () => addStructure("water"));
        addCrystalBtn.addEventListener("click", () => addStructure("crystal"));

        // Update preview function
        function updatePreview() {
          previewLifeForm.style.backgroundColor = selectedColor;
          previewName.textContent = lifeNameInput.value || "Unnamed Life Form";
          previewDescription.textContent =
            lifeDescriptionInput.value || "No description provided";

          // Update features visibility
          const features = previewLifeForm.querySelector(".life-features");
          features.innerHTML = "";

          if (hasEyesCheckbox.checked) {
            features.innerHTML += `
                        <div class="eye left">
                            <div class="pupil"></div>
                        </div>
                        <div class="eye right">
                            <div class="pupil"></div>
                        </div>
                    `;
          }

          if (hasMouthCheckbox.checked) {
            features.innerHTML += `<div class="mouth"></div>`;
          }

          if (hasLimbsCheckbox.checked) {
            features.innerHTML += `
                        <div class="limb horizontal top" style="background-color: ${selectedColor};"></div>
                        <div class="limb horizontal bottom" style="background-color: ${selectedColor};"></div>
                        <div class="limb vertical left" style="background-color: ${selectedColor};"></div>
                        <div class="limb vertical right" style="background-color: ${selectedColor};"></div>
                    `;
          }
        }

        // Add life form to gallery
        function addLifeToGallery(lifeForm) {
          const lifeCard = document.createElement("div");
          lifeCard.className = "life-card";
          lifeCard.setAttribute("data-id", lifeForm.id);
          lifeCard.innerHTML = `
                    <div class="life-card-preview" style="background-color: ${
                      lifeForm.color
                    };">
                        <div class="life-features">
                            ${
                              lifeForm.hasEyes
                                ? `
                                <div class="eye left">
                                    <div class="pupil"></div>
                                </div>
                                <div class="eye right">
                                    <div class="pupil"></div>
                                </div>
                            `
                                : ""
                            }
                            ${
                              lifeForm.hasMouth
                                ? '<div class="mouth"></div>'
                                : ""
                            }
                            ${
                              lifeForm.hasLimbs
                                ? `
                                <div class="limb horizontal top" style="background-color: ${lifeForm.color};"></div>
                                <div class="limb horizontal bottom" style="background-color: ${lifeForm.color};"></div>
                                <div class="limb vertical left" style="background-color: ${lifeForm.color};"></div>
                                <div class="limb vertical right" style="background-color: ${lifeForm.color};"></div>
                            `
                                : ""
                            }
                        </div>
                    </div>
                    <h3>${lifeForm.name}</h3>
                    <p>Type: ${lifeForm.type}</p>
                    <p>Generation: ${lifeForm.generation}</p>
                `;

          lifeCard.addEventListener("click", () => {
            // Select for simulation
            selectedLifeFormId = lifeForm.id;
            document
              .querySelectorAll(".life-card")
              .forEach((card) => card.classList.remove("selected"));
            lifeCard.classList.add("selected");
          });

          lifeGallery.appendChild(lifeCard);
          refreshSimulationGallery();
        }

        // Refresh simulation gallery
        function refreshSimulationGallery() {
          simulationGallery.innerHTML = "";

          createdLifeForms.forEach((lifeForm) => {
            const lifeCard = document.createElement("div");
            lifeCard.className = "life-card";
            lifeCard.setAttribute("data-id", lifeForm.id);
            lifeCard.innerHTML = `
                        <div class="life-card-preview" style="background-color: ${
                          lifeForm.color
                        };">
                            <div class="life-features">
                                ${
                                  lifeForm.hasEyes
                                    ? `
                                    <div class="eye left">
                                        <div class="pupil"></div>
                                    </div>
                                    <div class="eye right">
                                        <div class="pupil"></div>
                                    </div>
                                `
                                    : ""
                                }
                                ${
                                  lifeForm.hasMouth
                                    ? '<div class="mouth"></div>'
                                    : ""
                                }
                                ${
                                  lifeForm.hasLimbs
                                    ? `
                                    <div class="limb horizontal top" style="background-color: ${lifeForm.color};"></div>
                                    <div class="limb horizontal bottom" style="background-color: ${lifeForm.color};"></div>
                                    <div class="limb vertical left" style="background-color: ${lifeForm.color};"></div>
                                    <div class="limb vertical right" style="background-color: ${lifeForm.color};"></div>
                                `
                                    : ""
                                }
                            </div>
                        </div>
                        <h3>${lifeForm.name}</h3>
                        <p>Type: ${lifeForm.type}</p>
                        <p>Generation: ${lifeForm.generation}</p>
                        <button class="btn btn-primary add-to-sim" style="margin-top: 10px;">Add to Simulation</button>
                    `;

            lifeCard
              .querySelector(".add-to-sim")
              .addEventListener("click", (e) => {
                e.stopPropagation();
                addLifeToSimulation(lifeForm);
              });

            simulationGallery.appendChild(lifeCard);
          });
        }

        // Add life form to simulation
        function addLifeToSimulation(lifeForm) {
          const simulatedLife = {
            id: Date.now(),
            template: { ...lifeForm },
            x: Math.random() * (ecosystem.offsetWidth - 80),
            y: Math.random() * (ecosystem.offsetHeight - 80),
            size: 60 + Math.random() * 40,
            speed: 0.5 + Math.random() * 2,
            direction: Math.random() * Math.PI * 2,
            energy: 100,
            age: 0,
            maxAge: 100 + Math.floor(Math.random() * 100),
            reproductionCooldown: 0,
            generation: lifeForm.generation || 1,
            inShelter: false,
          };

          simulatedLifeForms.push(simulatedLife);
          addLogEntry(`${lifeForm.name} was added to the simulation`, "birth");
          updateStats();
          renderSimulation();
        }

        // Add food to simulation
        function addFood() {
          const food = {
            id: Date.now(),
            x: Math.random() * (ecosystem.offsetWidth - 10),
            y: Math.random() * (ecosystem.offsetHeight - 10),
          };

          foodItems.push(food);
          updateStats();
          renderSimulation();
        }

        // Add structure to simulation
        function addStructure(type) {
          const size =
            type === "house"
              ? 80
              : type === "rock"
              ? 40
              : type === "tree"
              ? 60
              : type === "water"
              ? 100
              : type === "crystal"
              ? 50
              : 60;

          const structure = {
            id: Date.now(),
            type: type,
            x: Math.random() * (ecosystem.offsetWidth - size),
            y: Math.random() * (ecosystem.offsetHeight - size),
            width: size,
            height: size,
          };

          structures.push(structure);
          addLogEntry(`A ${type} was added to the ecosystem`, "structure");
          showNotification(`Added a ${type} to the ecosystem`, "structure");
          updateStats();
          renderSimulation();
        }

        // Speed up simulation
        function speedUpSimulation() {
          simulationSpeed = simulationSpeed === 1 ? 2 : 1;
          speedUpBtn.textContent =
            simulationSpeed === 2 ? "Slow Down" : "Speed Up 2x";
          if (simulationInterval) {
            stopSimulation();
            startSimulation();
          }
        }

        // Start simulation
        function startSimulation() {
          if (simulationInterval) return;

          simulationInterval = setInterval(() => {
            for (let i = 0; i < simulationSpeed; i++) {
              simulationTime++;
              timeElapsedEl.textContent = `${simulationTime}s`;

              // Update life forms
              simulatedLifeForms.forEach((life, index) => {
                // Age the life form
                life.age += 0.1;

                // Check for death by old age
                if (life.age >= life.maxAge) {
                  simulatedLifeForms.splice(index, 1);
                  addLogEntry(
                    `${life.template.name} (Gen ${
                      life.generation
                    }) died of old age at ${Math.floor(life.age)}`,
                    "death"
                  );
                  updateStats();
                  return;
                }

                // Move in current direction
                life.x += Math.cos(life.direction) * life.speed;
                life.y += Math.sin(life.direction) * life.speed;

                // Bounce off walls
                if (
                  life.x <= 0 ||
                  life.x >= ecosystem.offsetWidth - life.size
                ) {
                  life.direction = Math.PI - life.direction;
                }
                if (
                  life.y <= 0 ||
                  life.y >= ecosystem.offsetHeight - life.size
                ) {
                  life.direction = -life.direction;
                }

                // Interact with structures
                let nearStructure = false;
                structures.forEach((structure) => {
                  const dx = life.x - (structure.x + structure.width / 2);
                  const dy = life.y - (structure.y + structure.height / 2);
                  const distance = Math.sqrt(dx * dx + dy * dy);

                  if (
                    distance <
                    life.size / 2 +
                      Math.max(structure.width, structure.height) / 2
                  ) {
                    nearStructure = true;

                    // Structure-specific interactions
                    switch (structure.type) {
                      case "house":
                        // Shelter provides energy regeneration
                        if (!life.inShelter) {
                          life.energy = Math.min(100, life.energy + 0.5);
                          life.inShelter = true;
                        }
                        break;
                      case "water":
                        // Water provides hydration
                        life.energy = Math.min(100, life.energy + 0.2);
                        break;
                      case "crystal":
                        // Crystals can cause mutations
                        if (Math.random() < 0.001) {
                          life.energy = Math.min(100, life.energy + 10);
                          addLogEntry(
                            `${life.template.name} was energized by a crystal!`,
                            "evolution"
                          );
                        }
                        break;
                      case "rock":
                        // Rocks are obstacles
                        life.direction = Math.random() * Math.PI * 2;
                        break;
                      case "tree":
                        // Trees provide occasional food
                        if (Math.random() < 0.005) {
                          addFood();
                          addLogEntry(
                            `${life.template.name} found fruit from a tree!`,
                            "birth"
                          );
                        }
                        break;
                    }

                    // Bounce off structures
                    life.direction = Math.atan2(dy, dx) + Math.PI;
                  }
                });

                if (!nearStructure) {
                  life.inShelter = false;
                }

                // Occasionally change direction
                if (Math.random() < 0.02) {
                  life.direction = Math.random() * Math.PI * 2;
                }

                // Look for food
                foodItems.forEach((food, foodIndex) => {
                  const dx = life.x - food.x;
                  const dy = life.y - food.y;
                  const distance = Math.sqrt(dx * dx + dy * dy);

                  if (distance < life.size / 2) {
                    // Eat food
                    foodItems.splice(foodIndex, 1);
                    life.energy = Math.min(100, life.energy + 30);
                    addLogEntry(`${life.template.name} found food!`, "birth");
                  }
                });

                // Lose energy (less if in shelter)
                life.energy -= life.inShelter ? 0.05 : 0.1;

                // Die if no energy
                if (life.energy <= 0) {
                  simulatedLifeForms.splice(index, 1);
                  addLogEntry(
                    `${life.template.name} (Gen ${life.generation}) died from lack of energy`,
                    "death"
                  );
                  updateStats();
                  return;
                }

                // Reproduction
                if (
                  life.energy > 70 &&
                  life.reproductionCooldown <= 0 &&
                  life.age > 20
                ) {
                  life.reproductionCooldown = 50;
                  reproduce(life);
                }

                if (life.reproductionCooldown > 0) {
                  life.reproductionCooldown--;
                }
              });

              // Occasionally add food automatically
              if (Math.random() < 0.05) {
                addFood();
              }
            }

            updateStats();
            renderSimulation();
          }, 100);
        }

        // Reproduction function
        function reproduce(parent) {
          const childTemplate = { ...parent.template };

          // Mutation chance
          if (Math.random() < 0.3) {
            // Evolve!
            evolutionCount++;
            evolutionCountEl.textContent = evolutionCount;

            // Random evolution
            const evolutionType = Math.floor(Math.random() * 4);
            switch (evolutionType) {
              case 0: // Color change
                const colors = [
                  "#4a6fa5",
                  "#51cf66",
                  "#ff6b6b",
                  "#f9c74f",
                  "#9d4edd",
                ];
                childTemplate.color =
                  colors[Math.floor(Math.random() * colors.length)];
                childTemplate.name = `Evolved ${parent.template.name}`;
                addLogEntry(
                  `${parent.template.name} evolved a new color!`,
                  "evolution"
                );
                break;
              case 1: // Size change
                childTemplate.name = `Giant ${parent.template.name}`;
                addLogEntry(
                  `${parent.template.name} evolved to be larger!`,
                  "evolution"
                );
                break;
              case 2: // New feature
                if (!childTemplate.hasLimbs) {
                  childTemplate.hasLimbs = true;
                  childTemplate.name = `Limbed ${parent.template.name}`;
                  addLogEntry(
                    `${parent.template.name} evolved limbs!`,
                    "evolution"
                  );
                } else if (!childTemplate.hasEyes) {
                  childTemplate.hasEyes = true;
                  childTemplate.name = `Sighted ${parent.template.name}`;
                  addLogEntry(
                    `${parent.template.name} evolved eyes!`,
                    "evolution"
                  );
                }
                break;
              case 3: // Speed increase
                childTemplate.name = `Swift ${parent.template.name}`;
                addLogEntry(
                  `${parent.template.name} evolved to be faster!`,
                  "evolution"
                );
                break;
            }

            showNotification(
              `${parent.template.name} has evolved!`,
              "evolution"
            );
          }

          childTemplate.generation = parent.generation + 1;
          generation = Math.max(generation, childTemplate.generation);
          generationCountEl.textContent = generation;

          // Add to created forms if it's a new evolution
          if (
            !createdLifeForms.find(
              (lf) =>
                lf.name === childTemplate.name &&
                lf.generation === childTemplate.generation
            )
          ) {
            createdLifeForms.push(childTemplate);
            refreshSimulationGallery();
          }

          // Create child in simulation
          const child = {
            id: Date.now(),
            template: childTemplate,
            x: parent.x + (Math.random() * 60 - 30),
            y: parent.y + (Math.random() * 60 - 30),
            size: Math.max(40, parent.size * (0.8 + Math.random() * 0.4)),
            speed: parent.speed * (0.9 + Math.random() * 0.2),
            direction: Math.random() * Math.PI * 2,
            energy: 50,
            age: 0,
            maxAge: parent.maxAge * (0.9 + Math.random() * 0.2),
            reproductionCooldown: 100,
            generation: childTemplate.generation,
            inShelter: false,
          };

          simulatedLifeForms.push(child);
          parent.energy -= 30; // Cost of reproduction

          addLogEntry(
            `${parent.template.name} gave birth to ${childTemplate.name}`,
            "birth"
          );
          showNotification(`${parent.template.name} reproduced!`, "birth");
        }

        // Stop simulation
        function stopSimulation() {
          if (simulationInterval) {
            clearInterval(simulationInterval);
            simulationInterval = null;
          }
        }

        // Clear simulation
        function clearSimulation() {
          stopSimulation();
          simulatedLifeForms = [];
          foodItems = [];
          structures = [];
          simulationTime = 0;
          generation = 1;
          evolutionCount = 0;
          logEntries = [];
          logEntriesEl.innerHTML = "";
          updateStats();
          renderSimulation();
        }

        // Update simulation stats
        function updateStats() {
          lifeCountEl.textContent = simulatedLifeForms.length;
          foodCountEl.textContent = foodItems.length;
          structureCountEl.textContent = structures.length;
          generationCountEl.textContent = generation;
          evolutionCountEl.textContent = evolutionCount;
        }

        // Render simulation
        function renderSimulation() {
          ecosystem.innerHTML = "";

          // Render structures
          structures.forEach((structure) => {
            const structureEl = document.createElement("div");
            structureEl.className = `structure ${structure.type}`;
            structureEl.style.left = `${structure.x}px`;
            structureEl.style.top = `${structure.y}px`;
            structureEl.style.width = `${structure.width}px`;
            structureEl.style.height = `${structure.height}px`;
            ecosystem.appendChild(structureEl);
          });

          // Render food
          foodItems.forEach((food) => {
            const foodEl = document.createElement("div");
            foodEl.className = "food";
            foodEl.style.left = `${food.x}px`;
            foodEl.style.top = `${food.y}px`;
            ecosystem.appendChild(foodEl);
          });

          // Render life forms
          simulatedLifeForms.forEach((life) => {
            const lifeEl = document.createElement("div");
            lifeEl.className = "simulated-life";
            lifeEl.style.width = `${life.size}px`;
            lifeEl.style.height = `${life.size}px`;
            lifeEl.style.left = `${life.x}px`;
            lifeEl.style.top = `${life.y}px`;
            lifeEl.style.backgroundColor = life.template.color;
            lifeEl.style.borderRadius = "50%";

            // Age indicator
            const ageEl = document.createElement("div");
            ageEl.className = "age-indicator";
            ageEl.textContent = `Age: ${Math.floor(life.age)}`;
            lifeEl.appendChild(ageEl);

            // Generation indicator for evolved forms
            if (life.generation > 1) {
              const genEl = document.createElement("div");
              genEl.className = "generation-counter";
              genEl.textContent = `Gen ${life.generation}`;
              lifeEl.appendChild(genEl);
            }

            // Add features
            const features = document.createElement("div");
            features.className = "life-features";

            if (life.template.hasEyes) {
              features.innerHTML += `
                            <div class="eye left" style="top: ${
                              life.size * 0.3
                            }px; left: ${life.size * 0.25}px;">
                                <div class="pupil"></div>
                            </div>
                            <div class="eye right" style="top: ${
                              life.size * 0.3
                            }px; right: ${life.size * 0.25}px;">
                                <div class="pupil"></div>
                            </div>
                        `;
            }

            if (life.template.hasMouth) {
              features.innerHTML += `
                            <div class="mouth" style="bottom: ${
                              life.size * 0.25
                            }px; left: ${life.size * 0.3}px; width: ${
                life.size * 0.4
              }px;"></div>
                        `;
            }

            if (life.template.hasLimbs) {
              features.innerHTML += `
                            <div class="limb horizontal top" style="background-color: ${
                              life.template.color
                            }; top: -${life.size * 0.1}px;"></div>
                            <div class="limb horizontal bottom" style="background-color: ${
                              life.template.color
                            }; bottom: -${life.size * 0.1}px;"></div>
                            <div class="limb vertical left" style="background-color: ${
                              life.template.color
                            }; left: -${life.size * 0.1}px;"></div>
                            <div class="limb vertical right" style="background-color: ${
                              life.template.color
                            }; right: -${life.size * 0.1}px;"></div>
                        `;
            }

            lifeEl.appendChild(features);
            ecosystem.appendChild(lifeEl);

            // Show evolution particles for newly evolved forms
            if (life.age < 5 && life.generation > 1) {
              for (let i = 0; i < 3; i++) {
                const particle = document.createElement("div");
                particle.className = "evolution-particle";
                particle.style.left = `${life.x + Math.random() * life.size}px`;
                particle.style.top = `${life.y + Math.random() * life.size}px`;
                particle.style.animationDelay = `${Math.random() * 2}s`;
                ecosystem.appendChild(particle);
              }
            }
          });
        }

        // Add log entry
        function addLogEntry(message, type) {
          const logEntry = document.createElement("div");
          logEntry.className = `log-entry ${type}`;
          logEntry.textContent = `[${simulationTime}s] ${message}`;
          logEntriesEl.appendChild(logEntry);
          logEntriesEl.scrollTop = logEntriesEl.scrollHeight;
        }

        // Show notification
        function showNotification(message, type = "normal") {
          notification.textContent = message;
          notification.className = "notification";
          if (type === "evolution") {
            notification.classList.add("evolution");
          } else if (type === "birth") {
            notification.classList.add("warning");
          } else if (type === "structure") {
            notification.classList.add("structure");
          }
          notification.classList.add("show");
          setTimeout(() => {
            notification.classList.remove("show");
          }, 3000);
        }

        // Initialize with empty gallery
        createdLifeForms = [];

        // Initialize preview
        updatePreview();
      });
    </script>
  </body>
</html>
